<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>streams.api documentation</title><script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-XJYNJF48RM"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XJYNJF48RM');</script><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Streams</span> <span class="project-version">1.000-alpha-1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></div></li><li class="depth-2 branch current"><a href="streams.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2"><a href="streams.graphs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphs</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="streams.api.html#var-*"><div class="inner"><span>*</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-.2B"><div class="inner"><span>+</span></div></a></li><li class="depth-1"><a href="streams.api.html#var--"><div class="inner"><span>-</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-.2F"><div class="inner"><span>/</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-batch-stream"><div class="inner"><span>batch-stream</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-bin-stream"><div class="inner"><span>bin-stream</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-def-double-binary-op"><div class="inner"><span>def-double-binary-op</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-def-double-op"><div class="inner"><span>def-double-op</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-def-double-unary-op"><div class="inner"><span>def-double-unary-op</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-fastmath-stream"><div class="inner"><span>fastmath-stream</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-filter"><div class="inner"><span>filter</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-fpow"><div class="inner"><span>fpow</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-gaussian-stream"><div class="inner"><span>gaussian-stream</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-interleave"><div class="inner"><span>interleave</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-limited.3F"><div class="inner"><span>limited?</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-log1p"><div class="inner"><span>log1p</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-map"><div class="inner"><span>map</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-prob-interleave"><div class="inner"><span>prob-interleave</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-sample"><div class="inner"><span>sample</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-stream"><div class="inner"><span>stream</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-take"><div class="inner"><span>take</span></div></a></li><li class="depth-1"><a href="streams.api.html#var-uniform-stream"><div class="inner"><span>uniform-stream</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">streams.api</h1><div class="doc"><div class="markdown"><p>Simple api for creating streams based on random sampling from distributions
along with minimal arithmetic and manipulation pathways.  Arithmetic ops can be
used on scalars and streams.</p>
<p>A stream is an object that when called as a function with no arguments returns
the next value in the stream but that also efficiently implements clojure.lang.IReduceInit
and clojure.lang.IReduce.  These are lazy noncaching versions of clojure's sequences.</p>
<p>Streams are strictly serial entities when they are being iterated.  There are no provisions
made to protect against threading issues.</p>
<p>Only arithmetic ops are specialized to doubles for performance reasons; streams can be
streams of arbitrary objects or really anything that implements IReduceInit.</p>
<p>Note that dtype-next has <a href="https://cnuernber.github.io/dtype-next/tech.v3.datatype.sampling.html">reservior-sampling</a>.</p>
<pre><code class="language-clojure">user&gt; (require '[streams.api :as streams])
nil
user&gt; (streams/sample 20 (streams/+ (streams/uniform-stream)
                                    (streams/* 2.0 (streams/uniform-stream))))
[1.5501202319376306, 0.7635588117246281, 2.3532562778994093, 2.209371262799305,
 1.3152501796238574, 1.0452647068536018, 0.7894558426559145, 2.198800934691462,
 0.26506472311487705, 2.538111046716471, 2.9001166286861992, 1.3705779064113792,
 2.1755184584145306, 1.3351040137971486, 1.6120692556203424, 1.6107428912151116,
 2.2510286054117365, 0.8765206662618311, 1.213693353303307, 1.2334256767045018]
</code></pre>
<p>For best performance keep streams unlimited until the very end.  This keeps intermediate streams from needing to check
if their sub-streams have in fact ended for every item:</p>
<pre><code class="language-clojure">  (streams/take 10000 (steams/+ a b))
</code></pre>
<p>Performs better than:</p>
<pre><code class="language-clojure">  (steams/+ (streams/take 10000 a) b)
</code></pre>
</div></div><div class="public anchor" id="var-*"><h3>*</h3><div class="usage"><code>(* a)</code><code>(* a b)</code><code>(* a b c)</code><code>(* a b c &amp; args)</code></div><div class="doc"><div class="markdown"><p>Binary or unary operation *.  Operates in the space of doubles. Arguments
may be streams or double scalars.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L922">view source</a></div></div><div class="public anchor" id="var-.2B"><h3>+</h3><div class="usage"><code>(+ a)</code><code>(+ a b)</code><code>(+ a b c)</code><code>(+ a b c &amp; args)</code></div><div class="doc"><div class="markdown"><p>Binary or unary operation +.  Operates in the space of doubles. Arguments
may be streams or double scalars.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L921">view source</a></div></div><div class="public anchor" id="var--"><h3>-</h3><div class="usage"><code>(- a)</code><code>(- a b)</code><code>(- a b c)</code><code>(- a b c &amp; args)</code></div><div class="doc"><div class="markdown"><p>Binary or unary operation -.  Operates in the space of doubles. Arguments
may be streams or double scalars.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L924">view source</a></div></div><div class="public anchor" id="var-.2F"><h3>/</h3><div class="usage"><code>(/ a)</code><code>(/ a b)</code><code>(/ a b c)</code><code>(/ a b c &amp; args)</code></div><div class="doc"><div class="markdown"><p>Binary or unary operation /.  Operates in the space of doubles. Arguments
may be streams or double scalars.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L923">view source</a></div></div><div class="public anchor" id="var-batch-stream"><h3>batch-stream</h3><div class="usage"><code>(batch-stream batch-fn)</code></div><div class="doc"><div class="markdown"><p>Given a function that returns a batch of data - which needs to look like a java.util.List
make a stream that reads the values of the batches.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L144">view source</a></div></div><div class="public anchor" id="var-bin-stream"><h3>bin-stream</h3><div class="usage"><code>(bin-stream s {:keys [n-bins sample-count x-axis-name y-axis-name], :or {sample-count 100000, x-axis-name :value, y-axis-name :sample-count}})</code><code>(bin-stream s)</code></div><div class="doc"><div class="markdown"><p>Bin a stream returning a sorted vector of {x-axis-name bin-left-marker y-axis-name sample-count}.
Returned values are sorted by x-axis-name.</p>
<p>The bin-size, x-axis-name and y-axis-name are returned as metdata on the return value.</p>
<p>Example:</p>
<pre><code class="language-clojure">user&gt; (require '[streams.api :as streams])
nil
user&gt; (def binned (streams/bin-stream (streams/gaussian-stream)))
#'user/binned
user&gt; (take 10 binned)
({:value -4.530608699974987, :sample-count 1}
 {:value -4.2370268390694985, :sample-count 1}
 {:value -4.139166218767668, :sample-count 1}
 {:value -4.041305598465839, :sample-count 2}
 {:value -3.8455843578621796, :sample-count 4}
 {:value -3.74772373756035, :sample-count 8}
 {:value -3.64986311725852, :sample-count 6}
 {:value -3.552002496956691, :sample-count 4}
 {:value -3.4541418766548606, :sample-count 18}
 {:value -3.3562812563530313, :sample-count 15})
user&gt; (meta binned)
{:x-axis-name :value,
 :y-axis-name :sample-count,
 :bin-size 0.09786062030182967,
 :min -4.530608699974987,
 :max 4.255453330207979}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L1004">view source</a></div></div><div class="public anchor" id="var-def-double-binary-op"><h3>def-double-binary-op</h3><h4 class="type">macro</h4><div class="usage"><code>(def-double-binary-op op-sym docstr)</code><code>(def-double-binary-op op-sym)</code></div><div class="doc"><div class="markdown"><p>Define a unary and binary double from clojure.core or another library such as +.
Operation need only have single arity of 2.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L927">view source</a></div></div><div class="public anchor" id="var-def-double-op"><h3>def-double-op</h3><h4 class="type">macro</h4><div class="usage"><code>(def-double-op op-sym)</code></div><div class="doc"><div class="markdown"><p>Define a unary and binary double from clojure.core or another library such as +.
Operation must have 1,2,+ arities.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L888">view source</a></div></div><div class="public anchor" id="var-def-double-unary-op"><h3>def-double-unary-op</h3><h4 class="type">macro</h4><div class="usage"><code>(def-double-unary-op op-sym docstr)</code><code>(def-double-unary-op op-sym)</code></div><div class="doc"><div class="markdown"><p>Define a unary and binary double from clojure.core or another library such as +.
Operation need only have single arity of 2.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L948">view source</a></div></div><div class="public anchor" id="var-fastmath-stream"><h3>fastmath-stream</h3><div class="usage"><code>(fastmath-stream n key opts)</code><code>(fastmath-stream key opts)</code><code>(fastmath-stream key)</code></div><div class="doc"><div class="markdown"><p>Create a stream based on a
<a href="https://generateme.github.io/fastmath/fastmath.random.html#var-distribution">fastmath distribution</a>.</p>
<p>You can provide a seed via providing an rng:</p>
<pre><code class="language-clojure">streams.api&gt; (def ds (fastmath-stream :exponential {:rng (fast-r/rng :mersenne 1)}))
#'streams.api/ds
streams.api&gt; (ds)
2.0910007182186208
streams.api&gt; (def ds (fastmath-stream :exponential {:rng (fast-r/rng :mersenne 1)}))
#'streams.api/ds
streams.api&gt; (ds)
2.0910007182186208
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L300">view source</a></div></div><div class="public anchor" id="var-filter"><h3>filter</h3><div class="usage"><code>(filter pred s)</code></div><div class="doc"><div class="markdown"><p>Filter a stream based on a predicate.  Returns a new stream.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L426">view source</a></div></div><div class="public anchor" id="var-fpow"><h3>fpow</h3><div class="usage"><code>(fpow a b)</code></div><div class="doc"><div class="markdown"><p>Fast pow where right-hand-side is interpreted as integer values.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L945">view source</a></div></div><div class="public anchor" id="var-gaussian-stream"><h3>gaussian-stream</h3><div class="usage"><code>(gaussian-stream n opts)</code><code>(gaussian-stream n)</code><code>(gaussian-stream)</code></div><div class="doc"><div class="markdown"><p>Create a gaussian stream with mean 0 variance 1. An integer seed may be provided with
:seed.  The specific rng you want may be selected with :rng and will be
passed to <a href="https://generateme.github.io/fastmath/fastmath.random.html#var-rng">fastmath.random/rng</a>.</p>
<pre><code class="language-clojure">streams.api&gt; (def s (gaussian-stream nil {:seed 1 :rng :mersenne}))
#'streams.api/s
streams.api&gt; (s)
1.0019203836877835
streams.api&gt; (def s (gaussian-stream nil {:seed 1 :rng :mersenne}))
#'streams.api/s
streams.api&gt; (s)
1.0019203836877835
streams.api&gt; fast-r/rngs-list
(:mersenne
 :well44497a
 :jdk
 :well19937c
 :well1024a
 :well19937a
 :well512a
 :isaac
 :well44497b)
streams.api&gt; (def s (gaussian-stream nil {:seed 1 :rng  :well512a}))
#'streams.api/s
streams.api&gt; (s)
-1.6141338321555592
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L250">view source</a></div></div><div class="public anchor" id="var-interleave"><h3>interleave</h3><div class="usage"><code>(interleave)</code><code>(interleave c0)</code><code>(interleave c0 c1)</code><code>(interleave c0 c1 &amp; args)</code></div><div class="doc"><div class="markdown"><p>Fast noncaching form of interleave.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L677">view source</a></div></div><div class="public anchor" id="var-limited.3F"><h3>limited?</h3><div class="usage"><code>(limited? s)</code></div><div class="doc"><div class="markdown"><p>Returns true if the stream has a limit</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L151">view source</a></div></div><div class="public anchor" id="var-log1p"><h3>log1p</h3><div class="usage"><code>(log1p a)</code></div><div class="doc"><div class="markdown"><p>Unary operation log1p.  Operates in the space of doubles. Argument may be a streams or a double.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L965">view source</a></div></div><div class="public anchor" id="var-map"><h3>map</h3><div class="usage"><code>(map mapfn s)</code><code>(map mapfn a b)</code><code>(map mapfn a b c)</code><code>(map mapfn a b c &amp; args)</code></div><div class="doc"><div class="markdown"><p>Map a function onto one or more streams.  Returns a new stream whose limit is the least
of any of the streams.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L560">view source</a></div></div><div class="public anchor" id="var-prob-interleave"><h3>prob-interleave</h3><div class="usage"><code>(prob-interleave args opts)</code><code>(prob-interleave args)</code></div><div class="doc"><div class="markdown"><p>Probabilistically interleave multiple streams.  Each argument must be a tuple
of <a href="stream prob">stream prob</a> and probabilities will be used with a flat distribution to decide
which stream to sample from.  Iteration stops when any of the component streams
is empty.</p>
<p>Options:</p>
<ul>
<li><code>:seed</code> - Provide an integer seed to construct a new java.util.Random.</li>
<li><code>:rng</code> - Provide a clojure function that takes no arguments and returns a double between
<a href="0-1">0-1</a>.</li>
</ul>
<p>Example:</p>
<pre><code class="language-clojure">streams.graphs&gt; (streams/sample 20 (streams/prob-interleave [[(streams/gaussian-stream) 0.1]
                                                             [(streams/gaussian-stream) 0.5]
                                                             [(streams/stream 2 1) 0.5]]))
[0.3261978516358189, 0.23722603841776788, 1.0, -0.16219928642385675, 1.0,
 0.43443517752548294, -1.93659876689825]
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L815">view source</a></div></div><div class="public anchor" id="var-sample"><h3>sample</h3><div class="usage"><code>(sample s)</code><code>(sample n s)</code></div><div class="doc"><div class="markdown"><p>Sample stream into a double array.  If n is not provided, stream must either
already have a limit or an oom is imminent.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L391">view source</a></div></div><div class="public anchor" id="var-stream"><h3>stream</h3><h4 class="type">macro</h4><div class="usage"><code>(stream code)</code><code>(stream l code)</code></div><div class="doc"><div class="markdown"><p>Create a 'stream' - the lazy noncaching form of repeatedly.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L92">view source</a></div></div><div class="public anchor" id="var-take"><h3>take</h3><div class="usage"><code>(take n s)</code></div><div class="doc"><div class="markdown"><p>Take at most N elements from this stream.  Returns a new stream.</p>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L363">view source</a></div></div><div class="public anchor" id="var-uniform-stream"><h3>uniform-stream</h3><div class="usage"><code>(uniform-stream n opts)</code><code>(uniform-stream n)</code><code>(uniform-stream)</code></div><div class="doc"><div class="markdown"><p>Create a uniform stream with values <a href="0-1">0-1</a>.  An integer seed may be provided with
:seed.  The specific rng you want may be selected with :rng and will be
passed to <a href="https://generateme.github.io/fastmath/fastmath.random.html#var-rng">fastmath.random/rng</a>.</p>
<pre><code class="language-clojure">streams.api&gt; (def s (gaussian-stream nil {:seed 1 :rng :mersenne}))
#'streams.api/s
streams.api&gt; (s)
1.0019203836877835
streams.api&gt; (def s (gaussian-stream nil {:seed 1 :rng :mersenne}))
#'streams.api/s
streams.api&gt; (s)
1.0019203836877835
streams.api&gt; fast-r/rngs-list
(:mersenne
 :well44497a
 :jdk
 :well19937c
 :well1024a
 :well19937a
 :well512a
 :isaac
 :well44497b)
streams.api&gt; (def s (gaussian-stream nil {:seed 1 :rng  :well512a}))
#'streams.api/s
streams.api&gt; (s)
-1.6141338321555592
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/cnuernber/streams/blob/master/src/streams/api.clj#L212">view source</a></div></div></div></body></html>